{{- /* Typo theme hook: injected at the end of <head>.
      We use it for:
      - Loading KaTeX CSS only when the page contains math
      - (Optional) Multilingual hreflang tags
      - (Optional) JSON-LD for posts/papers/notes
*/ -}}

{{- $hasMath := false -}}
{{- with .Page -}}
  {{- if .Store.Get "hasMath" -}}
    {{- $hasMath = true -}}
  {{- end -}}
{{- end -}}

{{- if $hasMath -}}
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/katex@0.16.28/dist/katex.min.css"
        crossorigin="anonymous">
{{- end -}}

{{- /* allow per-page robots override (e.g. noindex for /search/) */ -}}
{{- with .Params.robots -}}
  <meta name="robots" content="{{ . }}">
{{- end -}}

{{- /* hreflang (recommended for multilingual SEO) */ -}}
{{- if .IsTranslated -}}
  {{- range .AllTranslations -}}
    <link rel="alternate"
          hreflang="{{ .Language.LanguageCode | default .Language.Lang }}"
          href="{{ .Permalink }}">
  {{- end -}}
{{- end -}}

{{- /* JSON-LD (basic; adjust as needed) */ -}}
{{- $articleSections := slice "posts" "papers" "notes" "philosophy" -}}
{{- if and .IsPage (in $articleSections .Section) -}}
  {{- $desc := .Description -}}
  {{- if not $desc -}}
    {{- $desc = .Summary | plainify -}}
  {{- end -}}
  {{- $author := .Site.Params.author | default .Site.Title -}}
  {{- $schema := dict
      "@context" "https://schema.org"
      "@type" "BlogPosting"
      "headline" .Title
      "description" $desc
      "inLanguage" (.Site.Language.LanguageCode | default .Site.Language.Lang)
      "datePublished" (.Date.Format "2006-01-02T15:04:05Z07:00")
      "dateModified" (.Lastmod.Format "2006-01-02T15:04:05Z07:00")
      "url" .Permalink
      "mainEntityOfPage" (dict "@type" "WebPage" "@id" .Permalink)
      "author" (dict "@type" "Person" "name" $author)
      "publisher" (dict "@type" "Person" "name" $author)
    -}}
  <script type="application/ld+json">{{ $schema | jsonify }}</script>
{{- end -}}
